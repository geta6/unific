!function(){var e=[].indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(t in this&&this[t]===e)return t;return-1};$(function(){var t,n,i,d,r,o,a,c,s,u,l,f,m,h,p,g,v,w,F,k,y,b,I,B,H,V;return $(".alert").hide(),$("button.close").click(function(e){return e.currentTarget.parentElement.style.display="none"}),V=io.connect(),B=window.location.pathname.substr(1),b=!0,k=[],f=$("#GoButton"),m=$("#GoInput"),i=$("#Articles"),l=$("#FindFeedInput"),u=$("#FindFeedButton"),t=$("#AddFeedButton"),o=$("#EditFeedButton"),n=$("#ApplyEditFeedButton"),r=$("#CandidatesModalWindow"),a=$("#EditFeedModalWindow"),d=$("#CandidatesList"),s=$("#FeedList"),v=$("#NoFeedIsAdded"),w=$("#NoFeedIsFound"),g=$("#NoFeedIsAdded"),h=$("#NewArticleIsAdded"),p=$("#NewFeedIsAdded"),c=$("#FeedListIsEditted"),F=$("#SomethingWrong"),V.on("connect",function(){var e,E;return I()?(V.emit("connect stream",B),b&&(V.emit("sync stream",B),""===i.html()&&v.show(),b=!1),setInterval(function(){return console.log("sync"),V.emit("sync stream",B)},6e4),u.click(function(){return w.hide(),V.emit("find feed",l.val())}),V.on("found feed",function(e,t){var n,i,o,a;if(null!=e&&w.show(),null!=t.candidates){for(d.html(""),a=t.candidates,i=0,o=a.length;o>i;i++)n=a[i],n.sitetitle=""+n.sitename+" - "+(n.title||"feed"),n.siteurl=t.url,d.append(ViewHelper.candCheckbox(n));return r.modal()}}),V.on("sync completed",function(t){var n,i,d,r;for(i=_.sortBy(t,function(e){return Date.parse(e.page.pubDate)}),0!==t.length&&g.hide(),d=0,r=i.length;r>d;d++)n=i[d],y(n);return e(),E(),i.length>0?H(h):void 0}),o.click(function(){return V.emit("get feed_list",B)}),V.on("got feed_list",function(e){var t,n,i;if(null!=e){for(s.html(""),n=0,i=e.length;i>n;n++)t=e[n],s.append(ViewHelper.feedList(t));return a.modal()}}),n.click(function(){var e;return e=[],s.find(":checkbox:checked").each(function(){return e.push($(this).attr("url"))}),V.emit("edit feed_list",{urls:e,stream:B})}),V.on("edit completed",function(){return H(c),k=[],i.html(""),console.log("sync by feed_list editted"),V.emit("sync stream",B)}),t.click(function(){var e;return e=[],d.find(":checkbox:checked").each(function(){return e.push({url:$(this).val(),title:$(this).attr("title"),siteurl:$(this).attr("siteurl")})}),0!==e.length?V.emit("add feed",{urls:e,stream:B}):void 0}),V.on("add-feed succeed",function(){return H(p),console.log("sync"),V.emit("sync stream",B)}),V.on("star added",function(e){var t;return t=$(document).find("#"+e.domid),t.find("span.starred").html(ViewHelper.starredIcon(!0)),t.find("span.starButton").html(ViewHelper.starredButton(!0)),E()}),V.on("star deleted",function(e){var t;return t=$(document).find("#"+e.domid),t.find("span.starred").html(ViewHelper.starredIcon(!1)),t.find("span.starButton").html(ViewHelper.starredButton(!1)),E()}),V.on("comment added",function(e){var t,n,i,d,r;for(t=$(document).find("#"+e.domid),t.find(".comments").html(""),r=e.comments,i=0,d=r.length;d>i;i++)n=r[i],t.find(".comments").append("<blockquote>"+n+"</blockquote>");return t.find(".commentsLength").text(e.comments.length)}),V.on("error",function(){return H(F)}),e=function(){return $(".fancy").fancybox({fitToView:!1,width:"70%",height:"100%",autoSize:!0,closeClick:!0,openEffect:"none",closeEffect:"none"}),$(".read-more").click(function(){var e;return e=$(this).parent(),e.find("a.fancy").click()}),$(".submitComment").click(function(){var e,t;return e=$(this).parent(),t=e.find(".inputComment").val(),null!=t?V.emit("add comment",{domid:e.attr("id"),comment:t,stream:B}):void 0})},E=function(){return $(".starredButton").click(function(){var e,t;return e=$(this).parent().parent(),t=$(this).attr("value"),"star"===t?V.emit("add star",{domid:e.attr("id")}):"unstar"===t?V.emit("delete star",{domid:e.attr("id"),stream:B}):void 0})}):f.click(function(){return window.location.href=m.val()})}),H=function(e){return e.toggle("fade",500),setTimeout(function(){return e.toggle("fade",500)},5e3)},I=function(){return""===B?!1:!0},y=function(t){var n,d,r,o,a,c,s,u,l,f,m,h;for(l={title:t.page.title,id:t.page._id,comments:t.page.comments,description:t.page.description,pubDate:t.page.pubDate,url:t.page.url,sitename:t.feed.title,siteurl:t.feed.site,starred:t.page.starred},d="",h=t.page.comments,f=0,m=h.length;m>f;f++)n=h[f],d+=ViewHelper.comment(n);return u=i.find("li:first").attr("pubDate"),c=Date.parse(l.pubDate),a=c>=u,o=void 0===u,s=l.title,r=e.call(k,s)>=0,a&&!r||o?(i.prepend(ViewHelper.mediaHead(l)+d+ViewHelper.mediaFoot(l)).hide().fadeIn(500),k.push(s)):void 0}})}.call(this);