!function(){$(function(){var e,t,n,i,o,d;return $(".alert").hide(),$("button.close").click(function(e){return e.currentTarget.parentElement.style.display="none"}),d=io.connect(),o=window.location.pathname.substr(1),e=[],d.on("connect",function(){var a;return i()?(d.emit("connect stream",o),d.emit("sync stream",o),0===e.length&&$("#NoFeedIsAdded").show(),setInterval(function(){return console.log("sync"),d.emit("sync stream",o)},6e4),$("#FindFeedButton").click(function(){var e;return $("#NoFeedIsFound").hide(),e=$("#FindFeedInput").val(),d.emit("find feed",e)}),d.on("found feed",function(e,t){var n,i,o,d,a;if(null!=e&&$("#NoFeedIsFound").show(),null!=t.candidates){for($("#CandidatesModalWindow").find("#CandidatesList").html(""),a=t.candidates,o=0,d=a.length;d>o;o++)i=a[o],i.sitetitle=""+i.sitename+" - "+(i.title||"feed"),n="<li><input type='checkbox' siteurl="+t.url+" title= '"+i.sitetitle+"' value='"+i.url+"'>  "+i.sitetitle+"</li>",$("#CandidatesList").append(n);return $("#CandidatesModalWindow").modal()}}),d.on("sync completed",function(i){return n(e,i,function(n){var i,o,d;for(n.length>0?console.log("new article added"):console.log("no article added"),e=e.concat(n),e=_.uniq(e,function(e){return e.page._id}),0!==e.length&&$("#NoFeedIsAdded").hide(),o=0,d=n.length;d>o;o++)i=n[o],t(i);return a(),n.length>0?$("#NewArticleIsAdded").show().fadeIn(500):void 0})}),$("#AddFeedButton").click(function(){var e;return e=[],$("#CandidatesList").find(":checkbox:checked").each(function(){return e.push({url:$(this).val(),title:$(this).attr("title"),siteurl:$(this).attr("siteurl")})}),0!==e.length?d.emit("add feed",{urls:e,stream:o}):void 0}),d.on("add-feed succeed",function(){return $("#NewFeedIsAdded").show(),console.log("sync"),d.emit("sync stream",o)}),a=function(){return $(".btn-toggle").click(function(){var e;return e=$(this).parent(),"Close"===$(this).text()?(e.find("p.desc").show(),e.find("p.contents").hide(),$(this).text("Read More")):""!==e.find("p.contents").text()?(e.find("p.desc").hide(),e.find("p.contents").show(),e.find(".btn-toggle").text("Close")):d.emit("get page",{domid:e.attr("id"),url:e.find("a").attr("href")})}),d.on("got page",function(e){var t,n;return n=decodeURIComponent(e.res.content),t=$(document).find("#"+e.domid),t.find("p.desc").hide(),t.find("p.contents").show(),t.find("p.contents").html(n),t.find(".btn-toggle").text("Close")}),$(".submitComment").click(function(){var e,t;return e=$(this).parent(),t=e.find(".inputComment").val(),null!=t?d.emit("add comment",{domid:e.attr("id"),comment:t}):void 0}),d.on("comment added",function(e){var t,n;return t=$(document).find("#"+e.domid),t.find(".comments").append("<div class= 'well well-small'>"+e.comment+"</div><br>"),n=Number(t.find(".commentsLength").text()),t.find(".commentsLength").text(n+1)}),d.on("error",function(){return $("#SomethingWrong").show()})}):$("#GoButton").click(function(){return window.location.href=$("#GoInput").val()})}),i=function(){return""===o?!1:!0},n=function(e,t,n){var i,o;return o=_.map(e,function(e){return e.page._id}),i=_.filter(t,function(e){return _.contains(o,e.page._id)?!1:!0}),n(i)},t=function(e){var t,n,i,o,d,a,r,s,c,l,u,f,m;for(c=e.page.title,d=e.page._id,i=e.page.comments,o=e.page.description,a=moment(e.page.pubDate).fromNow(),l=e.page.url,r=e.feed.title,s=e.feed.site,n="",m=e.page.comments,u=0,f=m.length;f>u;u++)t=m[u],n+="        <div class= 'well well-small'>"+t+"</div>";return $("#Articles").prepend("    <li class='media well'>      <div class='media-body' id='"+d+"'>        <a href="+l+">          <h4 class='media-heading'>"+c+"               <a href='"+s+"''>               <small>"+r+"</small>            </a>          </h4>        </a>        <i class='icon-pencil'> "+a+"</i>        <i class='icon-comments-alt'>  Comments(<num class='commentsLength'>"+i.length+"</num>) </i>        <div class= 'starred'>          <i class='icon-star-empty'> starred</i>        </div>        <br>        <p class ='desc'>"+o+"</p>        <p class='contents'></p>        <div class='comments'>        "+n+"        </div>        <input type='text' placeholder='Comment...' class='inputComment input-medium search-query'>        <button  class='btn submitComment'><i class='icon-comment-alt'></i>  Comment</button>        <button class='btn btn-toggle'><i class='icon-hand-right'></i>  Read More</button>        <button class='btn btn-info'><i class='icon-star'></i>  Star</button>      </div>    </li>").hide().fadeIn(500)}})}.call(this);