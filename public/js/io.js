!function(){$(function(){var e,t,n,i,o,d;return $(".alert").hide(),$("button.close").click(function(e){return e.currentTarget.parentElement.style.display="none"}),d=io.connect(),o=window.location.pathname.substr(1),n=!0,e=$("#Articles"),d.on("connect",function(){var r;return i()?(d.emit("connect stream",o),n&&(d.emit("sync stream",o),""===e.html()&&$("#NoFeedIsAdded").show(),n=!1),setInterval(function(){return console.log("sync"),d.emit("sync stream",o)},6e4),$("#FindFeedButton").click(function(){var e;return $("#NoFeedIsFound").hide(),e=$("#FindFeedInput").val(),d.emit("find feed",e)}),d.on("found feed",function(e,t){var n,i,o,d;if(null!=e&&$("#NoFeedIsFound").show(),null!=t.candidates){for($("#CandidatesModalWindow").find("#CandidatesList").html(""),d=t.candidates,i=0,o=d.length;o>i;i++)n=d[i],n.sitetitle=""+n.sitename+" - "+(n.title||"feed"),n.url=t.url,$("#CandidatesList").append(ViewHelper.candCheckbox(n));return $("#CandidatesModalWindow").modal()}}),d.on("sync completed",function(e){var n,i,o,d;for(i=_.sortBy(e,function(e){return Date.parse(e.page.pubDate)}),0!==e.length&&$("#NoFeedIsAdded").hide(),o=0,d=i.length;d>o;o++)n=i[o],t(n);return r(),i.length>0?$("#NewArticleIsAdded").show().fadeIn(500):void 0}),$("#EditFeedButton").click(function(){return d.emit("get feed_list",o)}),d.on("got feed_list",function(e){var t,n,i;if(null!=e){for($("#EditFeedModalWindow").find("#FeedList").html(""),n=0,i=e.length;i>n;n++)t=e[n],$("#FeedList").append(ViewHelper.feedList(t));return $("#EditFeedModalWindow").modal()}}),$("#ApplyEditFeedButton").click(function(){var e;return e=[],$("#EditFeedModalWindow").find("#FeedList").find(":checkbox:checked").each(function(){return e.push($(this).attr("url"))}),d.emit("edit feed_list",{urls:e,stream:o})}),d.on("edit completed",function(){return $("#FeedListIsEditted").show(),e.html(""),console.log("sync by feed_list editted"),d.emit("sync stream",o)}),$("#AddFeedButton").click(function(){var e;return e=[],$("#CandidatesList").find(":checkbox:checked").each(function(){return e.push({url:$(this).val(),title:$(this).attr("title"),siteurl:$(this).attr("siteurl")})}),0!==e.length?d.emit("add feed",{urls:e,stream:o}):void 0}),d.on("add-feed succeed",function(){return $("#NewFeedIsAdded").show(),console.log("sync"),d.emit("sync stream",o)}),r=function(){return $(".fancy").fancybox({fitToView:!1,width:"70%",height:"100%",autoSize:!0,closeClick:!0,openEffect:"none",closeEffect:"none"}),$(".read-more").click(function(){var e;return e=$(this).parent(),e.find("a.fancy").click()}),$(".submitComment").click(function(){var e,t;return e=$(this).parent(),t=e.find(".inputComment").val(),null!=t?d.emit("add comment",{domid:e.attr("id"),comment:t}):void 0}),d.on("comment added",function(e){var t,n,i,o,d;for(t=$(document).find("#"+e.domid),t.find(".comments").html(""),d=e.comments,i=0,o=d.length;o>i;i++)n=d[i],t.find(".comments").append("<blockquote>"+n+"</blockquote>");return t.find(".commentsLength").text(e.comments.length)}),d.on("error",function(){return $("#SomethingWrong").show()})}):$("#GoButton").click(function(){return window.location.href=$("#GoInput").val()})}),i=function(){return""===o?!1:!0},t=function(t){var n,i,o,d,r,c,s,a,l,u,m,f,p;for(u={title:t.page.title,id:t.page._id,comments:t.page.comments,description:t.page.description,pubDate:t.page.pubDate,url:t.page.url,sitename:t.feed.title,siteurl:t.feed.site},i="",p=t.page.comments,m=0,f=p.length;f>m;m++)n=p[m],i+=ViewHelper.comment(n);return s=e.find("li:first").attr("pubDate"),r=Date.parse(u.pubDate),d=r>=s,o=void 0===s,a=e.find("li:first").find("h4").text(),c=u.title,l=a!==c,d&&l||o?e.prepend(ViewHelper.mediaHead(u)+i+ViewHelper.mediaFoot()).hide().fadeIn(500):void 0}})}.call(this);